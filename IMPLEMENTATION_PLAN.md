# カウンセラーメモ表示機能 - 実装計画

## 🎯 実装目標

既存のカウンセラーメモ機能を拡張し、ユーザーが自分の日記でカウンセラーからのコメントを確認できるようにする。

## 🛡️ 安全性重視の実装戦略

### ✅ 安全な理由
1. **既存機能の拡張**: 新機能追加ではなく、表示の拡張のみ
2. **データベース変更不要**: `counselor_memo`フィールドは既存
3. **権限システム変更不要**: 読み取り専用表示のみ
4. **最小限の変更**: 2つのファイルのみ修正

### 📋 実装手順

#### Phase 1: DiaryPage.tsx の修正
1. 既存の日記表示ロジックを確認
2. カウンセラーメモ表示エリアを最下部に追加
3. メモがある場合のみ表示
4. 読み取り専用として実装

#### Phase 2: DiarySearchPage.tsx の修正
1. Phase 1の動作確認後に実施
2. 同様のメモ表示エリアを追加
3. 検索結果での表示対応

### 🎨 UI設計

```
┌─────────────────────────────┐
│ 日記内容                    │
│ ・出来事                    │
│ ・感情                      │
│ ・気づき                    │
│ ・スコア（無価値感の場合）  │
├─────────────────────────────┤
│ 💬 カウンセラーからのコメント │
│ ┌─────────────────────────┐ │
│ │ [カウンセラー名]        │ │
│ │ メモ内容...             │ │
│ └─────────────────────────┘ │
└─────────────────────────────┘
```

### 🔍 実装詳細

#### 表示条件
- `counselor_memo`フィールドに内容がある場合のみ表示
- 空文字列や`null`の場合は非表示

#### 表示内容
- カウンセラー名（`assigned_counselor`から取得）
- メモ内容（`counselor_memo`から取得）
- 投稿日時（オプション）

#### スタイリング
- 既存のデザインシステムを使用
- 青系の背景色でカウンセラーコメントを区別
- 読み取り専用であることを視覚的に明示

### ⚠️ リスク管理

#### 想定されるリスク
1. **表示エラー**: メモデータが不正な場合
2. **レイアウト崩れ**: 長いメモ内容による影響
3. **パフォーマンス**: 大量のメモデータ読み込み

#### 対策
1. **エラーハンドリング**: try-catch文での安全な表示
2. **レスポンシブ対応**: 適切な改行とスクロール
3. **データ制限**: 表示文字数の制限

### 🧪 テスト計画

#### テストケース
1. メモがある日記での表示確認
2. メモがない日記での非表示確認
3. 長いメモでのレイアウト確認
4. 複数の日記での表示確認
5. レスポンシブデザインの確認

#### 確認項目
- [ ] 既存機能に影響なし
- [ ] エラーが発生しない
- [ ] レイアウトが崩れない
- [ ] パフォーマンスに問題なし
- [ ] 全デバイスで正常表示

### 📝 実装後の確認事項

1. **機能確認**
   - カウンセラーメモが正しく表示される
   - メモがない場合は表示されない
   - カウンセラー名が正しく表示される

2. **UI/UX確認**
   - デザインが統一されている
   - レスポンシブデザインが機能している
   - 読み取り専用であることが明確

3. **パフォーマンス確認**
   - ページ読み込み速度に影響なし
   - メモリ使用量に問題なし

## 🎯 成功基準

- ✅ 既存機能に一切影響を与えない
- ✅ エラーが発生しない
- ✅ UI/UXが崩れない
- ✅ ユーザーがカウンセラーからのコメントを確認できる
- ✅ カウンセラー名が適切に表示される

---

**この計画に従って、段階的かつ安全に実装を進めます。**